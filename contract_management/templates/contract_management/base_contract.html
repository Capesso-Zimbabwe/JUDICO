{% extends 'base.html' %}

{% block title %}Contract Management{% endblock %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'contract_management/css/contract_styles.css' %}">
{% endblock %}

{% block header_title %}Contract Management - Dashboard{% endblock %}

{% block content %}
<!-- Navigation header with improved styling -->
<div class="bg-white rounded-sm border-b border-gray-200 mb-4">
    <nav class="flex space-x-2 px-6 pt-3">
        <a href="{% url 'contract_management:contract_dashboard' %}" class="{% if request.resolver_match.url_name == 'contract_dashboard' %}border-b-2 border-blue-500 text-blue-600{% else %}border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-2 px-2 font-medium text-xs transition-colors duration-200">
            Dashboard
        </a>
        <a href="{% url 'contract_management:contract_list' %}" class="{% if request.resolver_match.url_name == 'contract_list' %}border-b-2 border-blue-500 text-blue-600{% else %}border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-2 px-2 font-medium text-xs transition-colors duration-200">
            All Contracts
        </a>
        <a href="{% url 'contract_management:template_list' %}" class="{% if request.resolver_match.url_name == 'template_list' %}border-b-2 border-blue-500 text-blue-600{% else %}border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %} whitespace-nowrap py-2 px-2 font-medium text-xs transition-colors duration-200">
            Templates
        </a>
    </nav>
</div>

{% block contract_content %}{% endblock %}

{% endblock %}

{% block extra_js %}
<script>
    // Common JavaScript functions for contract management
    
    // Show loading spinner
    function showLoading() {
        document.getElementById('loadingSpinner').style.display = 'block';
    }
    
    // Hide loading spinner
    function hideLoading() {
        document.getElementById('loadingSpinner').style.display = 'none';
    }
    
    // Show coming soon message
    function showComingSoon(feature) {
        alert(`${feature} feature is coming soon!`);
    }
    
    // Format currency
    function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        }).format(amount);
    }
    
    // Format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }
    
    // Show confirmation dialog
    function confirmAction(message, callback) {
        if (confirm(message)) {
            callback();
        }
    }
    
    // Show success message
    function showSuccess(message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
        alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(alertDiv);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.parentNode.removeChild(alertDiv);
            }
        }, 5000);
    }
    
    // Show error message
    function showError(message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show position-fixed';
        alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(alertDiv);
        
        // Auto remove after 7 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.parentNode.removeChild(alertDiv);
            }
        }, 7000);
    }
    
    // AJAX helper function
    function makeAjaxRequest(url, method = 'GET', data = null, headers = {}) {
        const defaultHeaders = {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
        };
        
        return fetch(url, {
            method: method,
            headers: { ...defaultHeaders, ...headers },
            body: data ? JSON.stringify(data) : null
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .catch(error => {
            console.error('AJAX request failed:', error);
            showError('An error occurred. Please try again.');
            throw error;
        });
    }
    
    // Initialize tooltips
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Initialize Bootstrap popovers
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
        });
        
        // Auto-hide alerts
        const alerts = document.querySelectorAll('.alert:not(.alert-permanent)');
        alerts.forEach(alert => {
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.classList.remove('show');
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 150);
                }
            }, 5000);
        });
    });
    
    // Search functionality
    function initializeSearch(searchInputId, searchUrl) {
        const searchInput = document.getElementById(searchInputId);
        if (!searchInput) return;
        
        let searchTimeout;
        
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            searchTimeout = setTimeout(() => {
                if (query.length >= 2 || query.length === 0) {
                    performSearch(query, searchUrl);
                }
            }, 300);
        });
    }
    
    function performSearch(query, url) {
        showLoading();
        
        const searchParams = new URLSearchParams(window.location.search);
        if (query) {
            searchParams.set('search', query);
        } else {
            searchParams.delete('search');
        }
        
        const newUrl = `${url}?${searchParams.toString()}`;
        window.location.href = newUrl;
    }
</script>
{% block contract_extra_js %}{% endblock %}
{% endblock %}