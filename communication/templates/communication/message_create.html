{% extends 'communication/base.html' %}

{% block title %}Communication - New Message{% endblock %}

{% block communication_content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">New Message</h1>
        <a href="{% url 'communication:messages' %}" class="text-gray-600 hover:text-gray-800">
            <i class="fas fa-arrow-left mr-2"></i>Back to Messages
        </a>
    </div>

    <!-- Message Form -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Recipients -->
            <div>
                <label for="recipients" class="block text-sm font-medium text-gray-700 mb-2">To:</label>
                <select id="recipients" name="recipients" multiple class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <option value="all_lawyers">All Lawyers</option>
                    <option value="all_staff">All Staff</option>
                    <option value="all_clients">All Clients</option>
                    <!-- Add dynamic user options here -->
                </select>
                <p class="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple recipients</p>
            </div>

            <!-- Subject -->
            <div>
                <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">Subject:</label>
                <input type="text" id="subject" name="subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter message subject" required>
            </div>

            <!-- Priority -->
            <div>
                <label for="priority" class="block text-sm font-medium text-gray-700 mb-2">Priority:</label>
                <select id="priority" name="priority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="low">Low</option>
                    <option value="normal" selected>Normal</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                </select>
            </div>

            <!-- Message Content -->
            <div>
                <label for="message" class="block text-sm font-medium text-gray-700 mb-2">Message:</label>
                <textarea id="message" name="message" rows="8" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your message here..." required></textarea>
            </div>

            <!-- Attachments -->
            <div>
                <label for="attachments" class="block text-sm font-medium text-gray-700 mb-2">Attachments:</label>
                <input type="file" id="attachments" name="attachments" multiple class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-xs text-gray-500 mt-1">You can attach multiple files (max 10MB each)</p>
            </div>

            <!-- Message Options -->
            <div class="flex items-center space-x-6">
                <label class="flex items-center">
                    <input type="checkbox" name="read_receipt" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-2 text-sm text-gray-700">Request read receipt</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="confidential" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-2 text-sm text-gray-700">Mark as confidential</span>
                </label>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-4 pt-6 border-t">
                <a href="{% url 'communication:messages' %}" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Cancel
                </a>
                <button type="button" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Save Draft
                </button>
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    <i class="fas fa-paper-plane mr-2"></i>Send Message
                </button>
            </div>
        </form>
    </div>

    <!-- Quick Templates -->
    <div class="bg-white rounded-lg shadow-md p-6 mt-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Quick Templates</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button type="button" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left" onclick="useTemplate('client_update')">
                <h3 class="font-medium text-gray-900">Client Update</h3>
                <p class="text-sm text-gray-600">Standard client progress update</p>
            </button>
            <button type="button" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left" onclick="useTemplate('meeting_request')">
                <h3 class="font-medium text-gray-900">Meeting Request</h3>
                <p class="text-sm text-gray-600">Request a meeting with colleagues</p>
            </button>
            <button type="button" class="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left" onclick="useTemplate('document_review')">
                <h3 class="font-medium text-gray-900">Document Review</h3>
                <p class="text-sm text-gray-600">Request document review</p>
            </button>
        </div>
    </div>
</div>

<script>
function useTemplate(templateType) {
    const templates = {
        'client_update': {
            subject: 'Client Case Update - [Case Name]',
            message: 'Dear [Client Name],\n\nI wanted to provide you with an update on your case...\n\nBest regards,\n[Your Name]'
        },
        'meeting_request': {
            subject: 'Meeting Request - [Topic]',
            message: 'Hello,\n\nI would like to schedule a meeting to discuss...\n\nPlease let me know your availability.\n\nBest regards,\n[Your Name]'
        },
        'document_review': {
            subject: 'Document Review Request - [Document Name]',
            message: 'Hello,\n\nCould you please review the attached document and provide your feedback?\n\nThank you,\n[Your Name]'
        }
    };
    
    const template = templates[templateType];
    if (template) {
        document.getElementById('subject').value = template.subject;
        document.getElementById('message').value = template.message;
    }
}
</script>
{% endblock %}