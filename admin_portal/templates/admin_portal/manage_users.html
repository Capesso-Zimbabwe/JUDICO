{% extends 'base.html' %}

{% block title %}Manage Users - Admin Portal{% endblock %}

{% block header_title %}Manage Users{% endblock %}

{% block content %}
<!-- Admin Sidebar Navigation -->
<div class="fixed inset-y-0 left-56 w-48 bg-white border-r border-gray-200 shadow-sm z-5 overflow-y-auto">
    <div class="p-4">
        <h3 class="text-sm font-semibold text-gray-800 mb-4">Admin Portal</h3>
        <nav class="space-y-1">
            <a href="{% url 'admin_portal:admin_dashboard' %}" 
               class="admin-nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                Dashboard
            </a>
            <a href="{% url 'admin_portal:manage_users' %}" 
               class="admin-nav-item active flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
                </svg>
                Manage Users
            </a>
            <a href="{% url 'admin_portal:manage_lawyers' %}" 
               class="admin-nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6M8 8v10l4-2 4 2V8" />
                </svg>
                Manage Lawyers
            </a>
            <a href="{% url 'contract_management:contract_dashboard' %}" 
               class="admin-nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Contract Management
            </a>
            <a href="#" 
               class="admin-nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Reports
            </a>
            <a href="#" 
               class="admin-nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Settings
            </a>
        </nav>
    </div>
</div>

<!-- Main Content Area with adjusted margin for admin sidebar -->
<div class="ml-48 p-8 bg-white rounded-lg shadow">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Manage Users</h2>
        <div class="flex space-x-2">
            <a href="{% url 'admin_portal:create_user' %}" class="bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 px-4 rounded">
                Create New User
            </a>
        </div>
    </div>
    
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User Type</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for user in users %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-xs">{{ user.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-xs">{{ user.get_full_name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-xs">{{ user.email }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-xs">
                        {% if user.is_staff %}
                            <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded">Staff</span>
                        {% elif user.id in lawyer_users %}
                            <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">Lawyer</span>
                        {% elif user.id in client_users %}
                            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">Client</span>
                        {% else %}
                            <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded">Regular User</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-xs">
                        <div class="flex space-x-2">
                            {% if not user.is_staff %}
                                <!-- Lawyer Toggle Button -->
                                <a href="{% url 'admin_portal:toggle_lawyer' user.id %}" 
                                   class="{% if user.id in lawyer_users %}bg-red-100 text-red-600 hover:bg-red-200{% else %}bg-green-100 text-green-600 hover:bg-green-200{% endif %} px-2 py-1 rounded text-xs font-medium">
                                    {% if user.id in lawyer_users %}
                                        Remove Lawyer
                                    {% else %}
                                        Make Lawyer
                                    {% endif %}
                                </a>
                                
                                <!-- Client Toggle Button -->
                                <a href="{% url 'admin_portal:toggle_client' user.id %}" 
                                   class="{% if user.id in client_users %}bg-red-100 text-red-600 hover:bg-red-200{% else %}bg-blue-100 text-blue-600 hover:bg-blue-200{% endif %} px-2 py-1 rounded text-xs font-medium">
                                    {% if user.id in client_users %}
                                        Remove Client
                                    {% else %}
                                        Make Client
                                    {% endif %}
                                </a>
                                
                                <!-- Delete Button -->
                                <a href="{% url 'admin_portal:delete_user' user.id %}" 
                                   class="bg-red-100 text-red-600 hover:bg-red-200 px-2 py-1 rounded text-xs font-medium" 
                                   onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.')">
                                    Delete
                                </a>
                            {% else %}
                                <span class="text-gray-400 text-xs">No actions available</span>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-6 py-4 text-center text-xs text-gray-500">No users found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.admin-nav-item {
    @apply text-black hover:text-blue-600 hover:bg-blue-50 transition-colors duration-200;
}

.admin-nav-item.active {
    @apply text-blue-600 bg-blue-50 border-r-2 border-blue-600;
}

.admin-nav-item:hover {
    @apply bg-blue-50 text-blue-600;
}
</style>
{% endblock %}