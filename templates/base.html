{% load tailwind_tags %} {% load static %}
<!DOCTYPE html>
<html lang="en" class="w-full h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}JUDICO - Legal Management System{% endblock %}
    </title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/law.png' %}" />
    <link
      rel="shortcut icon"
      type="image/png"
      href="{% static 'images/logo .png' %}"
    />
    <link rel="apple-touch-icon" href="{% static 'images/logo .png' %}" />
    <!-- Google Fonts - Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
    />

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Tailwind CSS -->
    {% tailwind_css %} {% block extra_css %}{% endblock %}
    <style>
      .scrollbar-thin::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .scrollbar-thin::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 2px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: #f58020;
      }

      body {
        font-family: "Nunito", sans-serif;
      }

      /* Add to your CSS file or in a <style> block */
      .htmx-indicator {
        display: none !important;
        opacity: 0 !important;
      }
      .htmx-request .htmx-indicator,
      .htmx-request.htmx-indicator {
        display: flex !important;
        opacity: 1 !important;
      }
      .htmx-request .button-text {
        opacity: 0 !important;
      }
    </style>

    <style>
      body {
        font-family: "Montserrat", sans-serif;
        font-size: 0.7rem;
      }
      .bg-custom-purple {
        background-color: #ffffff;
      }
      .bg-custom-orange {
        background-color: #f58020;
      }
      .text-custom-orange {
        color: #f58020;
      }
      .border-custom-orange {
        border-color: #f58020;
      }
      .hover\:bg-custom-orange:hover {
        background-color: #f58020;
      }
      .hover\:text-custom-orange:hover {
        color: #f58020;
      }
      .hover\:border-custom-orange:hover {
        border-color: #f58020;
      }

      .sidebar-link {
        position: relative;
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(229, 231, 235, 0.3);
      }
      .sidebar-link:hover {
        background-color: rgba(0, 0, 0, 0.05);
        padding-left: 1.25rem;
      }
      .sidebar-link.active {
        background-color: rgba(0, 0, 0, 0.05);
        border-left: 3px solid #f58020;
      }
      .sidebar-link:hover::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background-color: #f58020;
      }

      .header-height {
        height: 3.5rem;
      }

      .sidebar-icon {
        display: inline-block;
        width: 20px;
        margin-right: 8px;
        text-align: center;
      }

      .btn-primary {
        background-color: #f58020;
        color: white;
        transition: all 0.2s ease;
      }
      .btn-primary:hover {
        background-color: #e67615;
      }

      body.modal-open {
        overflow: hidden;
        padding-right: 0 !important;
      }
      .main-content {
        transition: none;
      }
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1040;
      }
      html {
        overflow-y: scroll;
      }
    </style>
  </head>

  <body
    class="bg-gray-50 min-h-screen max-w-full max-h-full overflow-hidden flex flex-col text-xs"
  >
    <!-- Sidebar with all modules -->
    <div
      id="main-sidebar"
      class="fixed -translate-x-full transition-transform xl:!translate-x-0 inset-y-0 left-0 w-56 bg-custom-purple text-gray-800 overflow-y-auto z-40 shadow-lg"
    >
      <!-- Added id="main-sidebar" -->
      <div class="p-3">
        <h3 class="text-lg font-bold text-gray-800">
          JUDICO <span class="text-custom-orange">HUB</span>
        </h3>
        <p class="text-xs text-gray-600 mt-0.5">Legal Management System</p>
      </div>
      <ul class="p-0 m-0 list-none mt-2">
        {% if user.is_authenticated and user.client_profile %}
        <!-- Client-specific navigation -->
        <li>
          <a
            href="{% url 'client_portal:dashboard' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </span>
            Dashboard
          </a>
        </li>
        <li>
          <a
            href="{% url 'client_portal:projects' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                />
              </svg>
            </span>
            My Projects
          </a>
        </li>
        <li>
          <a
            href="{% url 'client_portal:documents' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
            </span>
            Document Repository
          </a>
        </li>
        <li>
          <a
            href="{% url 'client_portal:communications' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                />
              </svg>
            </span>
            Communications
          </a>
        </li>

        {% elif user.is_authenticated and user.lawyer_profile %}
        <!-- Lawyer-specific navigation -->
        <li>
          <a
            href="{% url 'lawyer_portal:dashboard' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </span>
            Dashboard
          </a>
        </li>
        <li>
          <a
            href="/task/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                />
              </svg>
            </span>
            Project Management
          </a>
        </li>
        <li>
          <a
            href="/transaction/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"
                />
              </svg>
            </span>
            Transaction Support
          </a>
        </li>
        <li>
          <a
            href="/document/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
            </span>
            Document Repository
          </a>
        </li>
        <li>
          <a
            href="/communication/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                />
              </svg>
            </span>
            Communications
          </a>
        </li>

        {% else %}
        <!-- Full navigation for non-lawyers -->
        <li>
          <a
            href="{% url 'admin_portal:admin_dashboard' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </span>
            Dashboard
          </a>
        </li>
        <li>
          <a
            href="/task/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                />
              </svg>
            </span>
            Project Management
          </a>
        </li>
        <li>
          <a
            href="/finance/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </span>
            Accounting & Finance
          </a>
        </li>
        <li>
          <a
            href="/hr/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                />
              </svg>
            </span>
            HR Management
          </a>
        </li>
        <li>
          <a
            href="{% url 'hr_management:time_sheets' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </span>
            Time Tracking
          </a>
        </li>
        <li>
          <a
            href="/transaction/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"
                />
              </svg>
            </span>
            Transaction Support
          </a>
        </li>
        <li>
          <a
            href="/document/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                ></path>
              </svg>
            </span>
            Document Repository
          </a>
        </li>
        <li>
          <a
            href="/communication/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                />
              </svg>
            </span>
            Communication
          </a>
        </li>
        <li>
          <a
            href="/governance/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                />
              </svg>
            </span>
            Governance
          </a>
        </li>
        <li>
          <a
            href="/compliance/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                />
              </svg>
            </span>
            Compliance
          </a>
        </li>
        <li>
          <a
            href="/client/"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                />
              </svg>
            </span>
            Client & Case Management
          </a>
        </li>
        <li>
          <a
            href="{% url 'contract_management:contract_list' %}"
            class="sidebar-link block py-2 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
            </span>
            Contract Management
          </a>
        </li>
        {% endif %}

        <!-- Logout link at the very bottom of the sidebar -->
        <li
          class="absolute bottom-0 left-0 w-full border-t border-gray-200 mt-auto py-2"
        >
          <form id="logout-form" method="post" action="{% url 'logout' %}">
            {% csrf_token %}
          </form>
          <button
            onclick="document.getElementById('logout-form').submit()"
            class="sidebar-link block w-full py-3 px-3 hover:text-custom-orange text-black"
          >
            <span class="sidebar-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 inline"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                />
              </svg>
            </span>
            Logout
          </button>
        </li>
      </ul>
    </div>

    <!-- Header - improved height for perfect ratio -->
    <div
      class="xl:ml-56 relative flex flex-col flex-grow max-h-full max-w-full overflow-hidden"
    >
      {% include 'quotes/quote_display.html' %}
      <div
        class="sticky top-12 z-10 flex shadow-md justify-between items-center h-full px-4 py-3 bg-white text-gray-800 header-height"
      >
        <div class="flex gap-2 items-center">
          <button
            data-drawer-target="main-sidebar"
            data-drawer-toggle="main-sidebar"
            aria-controls="main-sidebar"
            type="button"
            class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg xl:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
          >
            <span class="sr-only">Open sidebar</span>
            <svg
              class="w-6 h-6"
              aria-hidden="true"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                clip-rule="evenodd"
                fill-rule="evenodd"
                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"
              />
            </svg>
          </button>
          <h2 class="text-sm font-semibold">
            {% block header_title %}Dashboard{% endblock %}
          </h2>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Notification icons -->
          <div class="flex items-center space-x-3">
            <span class="cursor-pointer hover:text-gray-600">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                />
              </svg>
            </span>
          </div>
          <!-- User profile - only showing initial with adjusted size -->
          <span class="text-xs flex items-center">
            <span
              class="bg-gray-500 text-white rounded-full h-6 w-6 flex items-center justify-center font-semi-bold text-xs"
            >
              {% if user.is_authenticated %} 
              {% if user.first_name and user.last_name %} 
              {{ user.first_name|first|upper }} 
              {{user.last_name|first|upper }} 
              {% elif user.first_name %} 
              {{ user.first_name|first|upper }} 
              {% elif user.last_name %} 
              {{ user.last_name|first|upper }} 
              {% else %} 
              {{user.username|first|upper }} 
              {% endif %} 
              {% else %} U 
              {% endif %}
            </span>
          </span>
        </div>
      </div>

      <!-- Daily Quote Display -->

      <!-- Main Content -->
      <div
        class="p-4 bg-gray-100 flex-grow relative flex flex-col flex-grow-1 min-h-0 max-w-full max-h-full overflow-y-auto"
      >
        {% block content %}{% endblock %}
      </div>
    </div>

    {% block modals %}{% endblock %}

    <!-- Time Tracking Widget -->
    {% if user.is_authenticated %} {% include
    'components/time_tracking_widget.html' %} {% endif %}

    <!-- Flowbite JS -->
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <!-- Flowbite JS -->
    <script>
      const modalOptions = {
        placement: 'bottom-right',
        backdrop: 'static',
        backdropClasses: 'bg-gray-900/50 fixed inset-0 z-40',
        {#closable: true,#}
        {#onHide: () => console.log('Modal hidden'),#}
        {#onShow: () => console.log('Modal shown'),#}
        {#onToggle: () => console.log('Modal toggled')#}
      };
    </script>
    <script>
      // Initialize Notyf
      const notyf = new Notyf({
        duration: 4000,
        position: { x: 'right', y: 'top' },
        types: [
          { type: 'warning', background: 'orange', icon: { className: 'bi bi-exclamation-triangle', tagName: 'i', text: '' } },
          { type: 'info', background: 'blue', icon: { className: 'bi bi-info-circle', tagName: 'i', text: '' } }
        ]
      });

      // Django Messages Integration
      {% if messages %}
        {% for message in messages %}
          {% if message.tags == 'error' %}
            notyf.error('{{ message|escapejs }}');
          {% elif message.tags == 'warning' %}
            notyf.open({ type: 'warning', message: '{{ message|escapejs }}' });
          {% elif message.tags == 'info' %}
            notyf.open({ type: 'info', message: '{{ message|escapejs }}' });
          {% elif message.tags == 'success' %}
            notyf.success('{{ message|escapejs }}');
          {% else %}
            notyf.success('{{ message|escapejs }}');
          {% endif %}
        {% endfor %}
      {% endif %}

      // Global notification functions for JavaScript usage
      window.showNotification = {
        success: function (message) { notyf.success(message); },
        error: function (message) { notyf.error(message); },
        warning: function (message) { notyf.open({ type: 'warning', message: message }); },
        info: function (message) { notyf.open({ type: 'info', message: message }); }
      };

      // HTMX integration for notifications
      document.body.addEventListener('htmx:afterRequest', function (evt) {
        const response = evt.detail.xhr;
        if (response.getResponseHeader('HX-Trigger')) {
          const triggers = JSON.parse(response.getResponseHeader('HX-Trigger'));
          if (triggers.notification) {
            const notification = triggers.notification;
            window.showNotification[notification.type](notification.message);
          }
        }
      });

      // Handle HTMX errors
      document.body.addEventListener('htmx:responseError', function () {
        window.showNotification.error('An error occurred. Please try again.');
      });

      document.body.addEventListener('htmx:sendError', function () {
        window.showNotification.error('Network error. Please check your connection.');
      });
    </script>
    <script>
      document.body.addEventListener("htmx:beforeRequest", function (evt) {
        const form = evt.target;
        const submitBtn = form.querySelector(".submit-btn");
        const inputs = form.querySelectorAll("input, select, textarea");

        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.querySelector(".btn-text").classList.add("hidden");
          submitBtn.querySelector(".btn-loading").classList.remove("hidden");
        }

        inputs.forEach((input) => {
          input.disabled = true;
        });
      });

      document.body.addEventListener("htmx:afterRequest", function (evt) {
        const form = evt.target;
        const submitBtn = form.querySelector(".submit-btn");
        const inputs = form.querySelectorAll("input, select, textarea");

        if (submitBtn) {
          submitBtn.disabled = false;
          const buttonText = submitBtn.querySelector(".btn-text");
          if (buttonText) buttonText.classList.remove("hidden");
          const loadingText = submitBtn.querySelector(".btn-loading");
          if (loadingText) loadingText.classList.add("hidden");
        }

        inputs.forEach((input) => {
          input.disabled = false;
        });
      });

      // File upload handler with loading states
      function handleFileUpload(fieldId) {
        const fileInput = document.getElementById(fieldId);
        if (!fileInput) {
          console.warn(`File input with ID '${fieldId}' not found`);
          return;
        }

        // Try to find upload area as parent first, then as sibling
        let uploadArea = fileInput.closest(".file-upload-area");
        if (!uploadArea) {
          const parent = fileInput.parentElement;
          if (parent) {
            uploadArea = parent.querySelector(".file-upload-area");
          }
        }

        if (!uploadArea) {
          console.warn(`Upload area not found for field '${fieldId}'`);
          return;
        }

        const uploadContent = uploadArea.querySelector(".upload-content");
        const uploadLoading = uploadArea.querySelector(".upload-loading");

        // Check if form is currently submitting
        const form = fileInput.closest("form");
        if (form && form.classList.contains("submitting")) {
          return; // Don't allow uploads during form submission
        }

        fileInput.click();

        fileInput.addEventListener("change", function (e) {
          if (e.target.files.length > 0) {
            if (uploadContent && uploadLoading) {
              uploadContent.classList.add("hidden");
              uploadLoading.classList.remove("hidden");
            }

            // Simulate upload progress (replace with actual upload logic)
            setTimeout(() => {
              if (uploadLoading && uploadContent) {
                uploadLoading.classList.add("hidden");
                uploadContent.classList.remove("hidden");
              }

              // Show selected file info
              const fileName = e.target.files[0].name;
              const fileInfo = document.createElement("div");
              fileInfo.className =
                "text-sm text-green-600 mt-2 flex items-center gap-1";
              fileInfo.innerHTML = `<i class="bi bi-check-circle"></i> ${fileName} selected`;

              const existingInfo = uploadArea.querySelector(".file-info");
              if (existingInfo) existingInfo.remove();

              fileInfo.classList.add("file-info");
              uploadArea.appendChild(fileInfo);
            }, 1500);
          }
        });
      }

      function disableFormElements(form) {
        const elements = form.querySelectorAll(
          '.form-field, button:not([type="button"])'
        );
        elements.forEach((element) => {
          element.disabled = true;
          element.classList.add("disabled-state");
        });

        const arrows = form.querySelectorAll(".select-arrow");
        arrows.forEach((arrow) => {
          arrow.style.opacity = "0.3";
        });
      }

      function enableFormElements(form) {
        const elements = form.querySelectorAll(".form-field, button");
        elements.forEach((element) => {
          element.disabled = false;
          element.classList.remove("disabled-state");
        });

        const arrows = form.querySelectorAll(".select-arrow");
        arrows.forEach((arrow) => {
          arrow.style.opacity = "1";
        });
      }

      function showButtonLoading(form) {
        const submitButtons = form.querySelectorAll('button[type="submit"]');
        submitButtons.forEach((button) => {
          const originalContent = button.innerHTML;
          button.setAttribute("data-original-content", originalContent);

          const loadingContent = `
            <div class="flex items-center justify-center gap-2">
              <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
              <span>Processing...</span>
            </div>
          `;

          button.innerHTML = loadingContent;
          button.classList.add("loading-state");
        });
      }

      function disableFileUploads(form) {
        const uploadAreas = form.querySelectorAll(".file-upload-area");
        uploadAreas.forEach((area) => {
          const uploadContent = area.querySelector(".upload-content");
          const uploadDisabled = area.querySelector(".upload-disabled");

          if (uploadContent && uploadDisabled) {
            uploadContent.classList.add("hidden");
            uploadDisabled.classList.remove("hidden");
          }

          area.style.pointerEvents = "none";
          area.classList.add("opacity-50");
        });
      }

      function enableFileUploads(form) {
        const uploadAreas = form.querySelectorAll(".file-upload-area");
        uploadAreas.forEach((area) => {
          const uploadContent = area.querySelector(".upload-content");
          const uploadDisabled = area.querySelector(".upload-disabled");

          if (uploadContent && uploadDisabled) {
            uploadContent.classList.remove("hidden");
            uploadDisabled.classList.add("hidden");
          }

          area.style.pointerEvents = "auto";
          area.classList.remove("opacity-50");
        });
      }
    </script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
